<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Video Site — Netflix-style Grid + ExoClick Ads</title>

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="favicon.png">

  <!-- FluidPlayer -->
  <link rel="stylesheet" href="https://cdn.fluidplayer.com/v3/current/fluidplayer.min.css">
  <script src="https://cdn.fluidplayer.com/v3/current/fluidplayer.min.js"></script>

  <style>
    :root{
      --bg:#000;
      --card:#121212;
      --accent:#e50914;
      --muted:#888;
      --text:#fff;
      --gap:12px;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter, system-ui, Arial, sans-serif;background:var(--bg);color:var(--text);-webkit-font-smoothing:antialiased}

    /* HEADER */
    header{
      background:linear-gradient(90deg,#111,#0b0b0b);
      padding:12px 20px;
      display:flex;
      align-items:center;
      gap:10px;
    }
    header img{
      height:42px;
      max-width:120px;
    }
    .brand{
      font-weight:700;
      font-size:20px;
      color:var(--accent);
      white-space:nowrap;
    }
    nav{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      margin-left:auto;
    }
    nav button{
      background:transparent;
      border:1px solid #222;
      color:var(--muted);
      padding:6px 12px;
      border-radius:999px;
      cursor:pointer;
      font-size:14px;
    }
    nav button.active{
      background:var(--accent);
      color:#fff;
      border-color:var(--accent);
    }

    /* Responsive header */
    @media(max-width:768px){
      header{flex-wrap:wrap;justify-content:center;text-align:center}
      header img{height:34px;max-width:100px}
      .brand{font-size:16px}
      nav{margin-left:0;justify-content:center;width:100%}
      nav button{font-size:12px;padding:5px 10px}
    }

    /* MAIN GRID */
    .main{max-width:1200px;margin:18px auto;padding:0 16px}
    .grid{
      display:grid;
      grid-template-columns:repeat(5,1fr);
      gap:var(--gap);
    }
    @media(max-width:1100px){.grid{grid-template-columns:repeat(3,1fr)}}
    @media(max-width:700px){.grid{grid-template-columns:repeat(2,1fr)}}

    .card{background:var(--card);border-radius:8px;overflow:hidden;cursor:pointer;transition:transform .18s,box-shadow .18s}
    .card:hover{transform:translateY(-6px);box-shadow:0 12px 30px rgba(0,0,0,.6)}
    .thumb{position:relative;padding-top:56.25%;background:#000;overflow:hidden}
    .thumb img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;display:block}
    .duration{position:absolute;right:6px;bottom:6px;background:rgba(0,0,0,.6);color:#fff;padding:4px 7px;border-radius:4px;font-size:12px}

    .meta{padding:10px}
    .meta h3{margin:0;font-size:14px;line-height:1.2;color:var(--text);min-height:2.4em}
    .meta p{margin:6px 0 0;color:var(--muted);font-size:13px}

    /* MODAL PLAYER */
    .modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.85);align-items:center;justify-content:center;z-index:9999;padding:18px}
    .modal-inner{width:min(100%,1100px);background:transparent;border-radius:10px;overflow:hidden}
    .close-btn{position:absolute;right:18px;top:18px;background:var(--accent);border:none;color:#fff;padding:10px 12px;border-radius:8px;cursor:pointer;z-index:10001}
    .player-wrap{background:#000;padding:10px;border-radius:8px}

    /* LOADING */
    #loading{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.6);z-index:10000}
    .spinner{width:48px;height:48px;border-radius:50%;border:6px solid #111;border-top-color:var(--accent);animation:spin 1s linear infinite}
    @keyframes spin{100%{transform:rotate(360deg)}}

    footer{padding:20px;text-align:center;color:var(--muted);font-size:13px}
  </style>
</head>
<body>
  <div id="loading"><div class="spinner"></div></div>

  <!-- HEADER -->
  <header>
    <img src="logo.png" alt="Logo">
    <div class="brand">ABG TUBE HD</div>
    <nav id="catNav"></nav>
  </header>

  <!-- GRID -->
  <main class="main">
    <section class="grid" id="grid"></section>
    <div style="display:flex;justify-content:center;margin:18px 0">
      <button id="loadMore" style="background:transparent;border:1px solid #222;color:var(--muted);padding:8px 14px;border-radius:8px;cursor:pointer">Muat Lebih</button>
    </div>
  </main>

  <!-- MODAL -->
  <div class="modal" id="modal">
    <div class="modal-inner" id="modalInner">
      <button class="close-btn" id="closeBtn">Tutup ✕</button>
      <div class="player-wrap" id="playerWrap"></div>
    </div>
  </div>

  <footer>
    Dibuat dengan ♥ — Oleh ABG TUBE HD.
  </footer>

<script>
/* ============================
  Konfigurasi — GANTI INI
   - API_KEY: API key Blogger kamu
   - BLOG_ID: ID blog kamu
   - EXOCLICK_VAST_PRE_MID_POST: ganti zoneid dengan milikmu
   - ITEMS_PER_PAGE: berapa banyak post di-load per request
   - NOTE: postingan harus mengandung link .mp4 (direct)
   ============================ */
const API_KEY = "AIzaSyAMVYNjwqJn8msXdSdsX1qxXfokNFrBoUc";
const BLOG_ID = "4623374530313514158";
const EXOCLICK_VAST_PRE = "https://ads.exoclick.com/vast.php?zoneid=1234567"; // GANTI
const EXOCLICK_VAST_MID = "https://ads.exoclick.com/vast.php?zoneid=1234567"; // GANTI
const EXOCLICK_VAST_POST = "https://ads.exoclick.com/vast.php?zoneid=1234567"; // GANTI
const ITEMS_PER_PAGE = 24;

let nextPageToken = "";
let isLoading = false;

function hideLoader(){
  const L=document.getElementById('loading'); 
  if(L) L.style.display='none';
}
setTimeout(hideLoader,6000);

async function fetchPosts(pageToken=""){
  if(isLoading) return;
  isLoading=true;
  document.getElementById('loadMore').textContent = "Memuat...";
  let url = `https://www.googleapis.com/blogger/v3/blogs/${BLOG_ID}/posts?key=${API_KEY}&maxResults=${ITEMS_PER_PAGE}&fetchImages=true`;
  if(pageToken) url += `&pageToken=${encodeURIComponent(pageToken)}`;
  try{
    const res = await fetch(url);
    const data = await res.json();
    nextPageToken = data.nextPageToken || "";
    return data.items || [];
  }catch(err){
    console.error("Fetch posts error", err);
    return [];
  }finally{
    isLoading=false;
    document.getElementById('loadMore').textContent = "Muat Lebih";
    hideLoader();
  }
}

function extractMp4FromContent(content){
  if(!content) return null;
  const match = content.match(/https?:\/\/[^"'\s<>]+\.mp4/gi);
  return match ? match[0] : null;
}

function extractThumbnail(content){
  if(!content) return "https://via.placeholder.com/640x360?text=No+Thumb";
  const m = content.match(/<img[^>]+src="([^">]+)"/i);
  return m ? m[1] : "https://via.placeholder.com/640x360?text=No+Thumb";
}

function createCard(post){
  const mp4 = extractMp4FromContent(post.content || "");
  const thumb = extractThumbnail(post.content || "");
  const item = document.createElement('article');
  item.className = 'card';
  item.innerHTML = `
    <div class="thumb">
      <img src="${thumb}" alt="${escapeHtml(post.title)}" loading="lazy" />
    </div>
    <div class="meta">
      <h3>${escapeHtml(post.title)}</h3>
      <p>${new Date(post.published).toLocaleDateString()}</p>
    </div>`;
  if(mp4){
    item.addEventListener('click', ()=> openPlayer(mp4, post.title));
  } else {
    item.addEventListener('click', ()=> window.open(post.url, "_blank"));
  }
  return item;
}

function escapeHtml(s){ 
  return (s||"").replace(/[&<>"']/g, 
    (m)=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m]));
}

async function renderMore(){
  const posts = await fetchPosts(nextPageToken);
  const grid = document.getElementById('grid');
  posts.forEach(p=> grid.appendChild(createCard(p)));
}

let activePlayerInstance = null;
function openPlayer(videoUrl, title="Video"){
  const modal = document.getElementById('modal');
  const wrap = document.getElementById('playerWrap');
  modal.style.display = 'flex';
  wrap.innerHTML = '';

  const video = document.createElement('video');
  video.id = 'fp-video';
  video.setAttribute('controls','');
  video.setAttribute('preload','metadata');
  video.style.width = '100%';
  video.style.maxHeight = '80vh';
  video.innerHTML = `<source src="${videoUrl}" type="video/mp4">Your browser does not support the video tag.`;
  wrap.appendChild(video);

  const titleEl = document.createElement('div');
  titleEl.style.color = '#ddd';
  titleEl.style.margin = '8px 0 4px';
  titleEl.textContent = title;
  wrap.insertBefore(titleEl, video);

  const onMeta = () => {
    try {
      const duration = video.duration || 0;
      let midRolls = [];
      if(duration > 30){
        const a = Math.floor(duration * 0.25);
        const b = Math.floor(duration * 0.75);
        if(a > 5 && a < duration - 10) midRolls.push(a);
        if(b > 5 && b < duration - 5 && Math.abs(b - a) > 10) midRolls.push(b);
      }
      const adList = [];
      adList.push({ roll: 'preRoll', vastTag: EXOCLICK_VAST_PRE, adText: 'Iklan akan selesai dalam' });
      midRolls.forEach(t => {
        adList.push({ roll: 'midRoll', vastTag: EXOCLICK_VAST_MID, timer: t, adText: 'Iklan akan selesai dalam' });
      });
      adList.push({ roll: 'postRoll', vastTag: EXOCLICK_VAST_POST, adText: 'Iklan akan selesai dalam' });

      try{ if(activePlayerInstance && activePlayerInstance.destroy) activePlayerInstance.destroy(); }catch(e){}
      activePlayerInstance = fluidPlayer('fp-video', {
        layoutControls: { primaryColor: '#e50914', fillToContainer: true },
        vastOptions: { adList }
      });
    } catch(err){ console.error("player init error", err); }
    video.removeEventListener('loadedmetadata', onMeta);
  };
  video.addEventListener('loadedmetadata', onMeta);
  if(video.readyState >= 1 && video.duration) onMeta();
}

document.getElementById('closeBtn').addEventListener('click', closeModal);
function closeModal(){
  const modal = document.getElementById('modal');
  modal.style.display = 'none';
  try{
    if(activePlayerInstance && activePlayerInstance.destroy) activePlayerInstance.destroy();
  }catch(e){}
  document.getElementById('playerWrap').innerHTML = '';
}

async function buildCategories(){
  const url = `https://www.googleapis.com/blogger/v3/blogs/${BLOG_ID}/posts?key=${API_KEY}&maxResults=50`;
  try{
    const res = await fetch(url);
    const data = await res.json();
    const labelsSet = new Set();
    (data.items || []).forEach(it => {
      (it.labels || []).forEach(l => labelsSet.add(l));
    });
    const nav = document.getElementById('catNav');
    const allBtn = document.createElement('button');
    allBtn.textContent = 'Semua';
    allBtn.className = 'active';
    allBtn.addEventListener('click', ()=> { 
      document.querySelectorAll('#catNav button').forEach(b=>b.classList.remove('active')); 
      allBtn.classList.add('active'); 
      resetAndLoad(''); 
    });
    nav.appendChild(allBtn);
    labelsSet.forEach(lbl => {
      const b = document.createElement('button');
      b.textContent = lbl;
      b.addEventListener('click', ()=> { 
        document.querySelectorAll('#catNav button').forEach(bt=>bt.classList.remove('active')); 
        b.classList.add('active'); 
        resetAndLoad(lbl); 
      });
      nav.appendChild(b);
    });
  }catch(err){
    console.warn('Could not build categories', err);
  }
}

function resetAndLoad(label=""){
  document.getElementById('grid').innerHTML = '';
  nextPageToken = "";
  renderMore();
}

document.addEventListener('DOMContentLoaded', async ()=>{
  await buildCategories();
  await renderMore();
  document.getElementById('loadMore').addEventListener('click', ()=> {
    if(nextPageToken) renderMore(); else renderMore();
  });
  hideLoader();
});
</script>
</body>
</html>
